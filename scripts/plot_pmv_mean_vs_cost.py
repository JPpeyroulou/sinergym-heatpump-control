"""Plot: X = PMV promedio anual, Y = Costo anual.
Curva ON/OFF + ALL PPO and SAC trained models."""

import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
import numpy as np

# --- ON/OFF data: (setpoint, mean_pmv_annual, cost_$k) ---
data_onoff = [
    (20, -0.8384, 39.6),
    (21, -0.6369, 53.8),
    (22, -0.4168, 69.5),
    (23, -0.1959, 87.1),
    (24,  0.0331, 106.5),
    (25,  0.2529, 125.7),
    (26,  0.4686, 143.0),
    (27,  0.6695, 157.5),
    (28,  0.8555, 170.7),
]

# --- All PPO models: (timestamp, pmv, cost_k) ---
ppo_all = [
    ('02-12_10-32', -0.6199, 77.6),
    ('02-12_10-59', -0.9435, 42.9),
    ('02-12_11-10', -0.6761, 68.8),
    ('02-12_11-22', -0.9309, 36.6),
    ('02-12_11-33', -0.6834, 77.4),
    ('02-12_11-44', -0.4046, 97.5),
    ('02-12_11-56', -0.5477, 84.5),
    ('02-12_12-07', -0.6125, 80.3),
    ('02-12_12-20', -0.6973, 70.6),
    ('02-12_21-39', -0.6219, 74.6),
    ('02-12_21-55', -0.5326, 81.4),
    ('02-12_22-53', -0.5743, 78.8),
    ('02-13_19-35', -0.5896, 74.7),
    ('02-14_23-30', -0.4983, 82.0),
    ('02-15_00-14', -0.3290, 93.2),
    ('02-15_01-35', -0.7006, 65.7),
    ('02-15_02-04', -0.5597, 79.0),
    ('02-15_02-35', -0.5674, 79.9),
    ('02-15_03-32', -0.6169, 71.7),
    ('02-15_03-33', -0.6317, 72.5),
    ('02-15_05-05', -0.5821, 76.1),
    ('02-15_06-10', -0.5580, 81.7),
    ('02-15_19-02', -0.5447, 73.6),
    ('02-15_22-16', -0.5464, 80.3),
    ('02-16_03-47', -0.5012, 80.9),
    ('02-16_15-19', -0.1733, 112.5),
    ('02-16_17-05', -0.5003, 83.6),
    ('02-16_18-12', -0.1820, 110.5),
    ('02-16_21-15', -0.2043, 105.9),
    ('02-16_23-55', -1.4482,  0.3),
    ('02-17_00-58', -0.6040, 65.1),
    ('02-17_02-11', -0.3584, 90.9),
    ('02-17_02-58', -0.4929, 77.3),
    ('02-17_03-39', -0.3581, 99.1),
    ('02-17_23-37', -0.0479, 128.6),
    ('02-17_23-57', -0.0977, 122.2),
    ('02-19_22-21', -0.0504, 127.9),
]

# --- All SAC models: (timestamp, pmv, cost_k) ---
sac_all = [
    ('02-07_00-19',  0.6793, 174.2),
    ('02-11_22-29',  0.0620, 130.3),
    ('02-11_22-50', -1.2446,  17.0),
    ('02-11_23-22', -1.4229,   0.9),
    ('02-11_23-56', -1.3360,   8.5),
    ('02-12_00-29', -0.5650,  73.5),
    ('02-12_00-53', -0.4828,  78.1),
    ('02-12_01-20', -0.9272,  44.7),
    ('02-12_01-40', -1.0621,  33.1),
    ('02-12_02-02', -0.4889,  83.7),
    ('02-12_02-23', -0.6410,  69.6),
    ('02-12_02-44', -1.0905,  31.3),
    ('02-12_03-06', -0.7908,  59.6),
    ('02-12_03-30', -1.0704,  33.4),
    ('02-12_03-51', -0.7374,  61.5),
    ('02-12_04-33', -0.9844,  36.6),
    ('02-12_05-16', -1.0739,  32.6),
    ('02-12_05-38', -0.3789,  95.7),
    ('02-12_05-59', -0.7912,  56.4),
    ('02-12_06-21', -0.7400,  60.5),
    ('02-12_06-43', -0.9477,  46.6),
    ('02-12_07-04', -0.3887,  95.6),
    ('02-12_07-26', -0.6820,  65.3),
    ('02-12_07-47', -0.5585,  82.9),
    ('02-12_08-09', -0.6238,  74.1),
    ('02-12_10-01', -1.0567,  32.9),
    ('02-12_12-19', -1.0781,  31.5),
    ('02-12_19-56', -0.2686, 106.8),
    ('02-12_20-35', -0.4763,  86.1),
    ('02-12_20-57', -1.3279,  18.9),
    ('02-12_21-18', -0.6255,  73.3),
    ('02-12_21-55', -0.4359,  92.1),
    ('02-12_22-22', -1.0833,  42.4),
    ('02-12_22-53', -0.6385,  81.9),
    ('02-12_23-20', -0.8721,  50.0),
    ('02-12_23-41', -0.7591,  58.6),
    ('02-12_23-52', -0.6201,  69.4),
    ('02-13_00-25', -0.7711,  57.6),
    ('02-13_01-01', -0.3562,  91.6),
    ('02-13_01-23', -1.1084,  38.5),
    ('02-13_01-44', -0.6105,  71.0),
    ('02-13_02-05', -0.7569,  57.2),
    ('02-13_02-26', -0.7608,  59.2),
    ('02-13_02-48', -0.4393,  85.4),
    ('02-13_03-09', -0.3722,  94.3),
    ('02-13_03-41', -0.2470, 105.3),
    ('02-13_04-02', -0.5606,  76.9),
    ('02-13_04-23', -0.5048,  94.2),
    ('02-13_04-45', -0.8940,  45.1),
    ('02-13_05-06', -0.6631,  78.7),
    ('02-13_05-27', -0.5780,  75.4),
    ('02-13_05-53', -0.6396,  69.1),
    ('02-13_06-14', -0.8868,  46.0),
    ('02-13_06-44', -0.9461,  41.0),
    ('02-13_17-49', -0.4340,  84.2),
    ('02-13_18-11', -1.0236,  34.9),
    ('02-13_18-37', -0.8113,  52.1),
    ('02-13_18-59', -0.4943,  75.7),
    ('02-13_20-16', -0.5049,  74.9),
    ('02-13_20-38', -0.5131,  71.6),
    ('02-13_20-59', -0.4317,  83.8),
    ('02-13_21-20', -0.5829,  73.8),
    ('02-13_21-41', -0.5518,  83.2),
    ('02-13_22-05', -0.6450,  78.9),
    ('02-14_00-04', -0.6099,  61.3),
    ('02-14_00-31', -0.4168,  88.3),
    ('02-14_00-57', -0.6266,  66.9),
    ('02-14_01-23', -0.3583,  88.6),
    ('02-14_01-50', -0.9180,  43.7),
    ('02-14_02-15', -0.7437,  57.6),
    ('02-14_02-52', -0.2081, 107.0),
    ('02-14_03-28', -0.7366,  60.8),
    ('02-14_03-54', -1.1186,  23.9),
    ('02-14_04-20', -0.4252,  98.4),
    ('02-14_04-46', -0.9347,  42.0),
    ('02-14_05-13', -0.2823,  96.1),
    ('02-14_05-39', -0.5601,  72.5),
    ('02-14_06-05', -0.7436,  53.8),
    ('02-14_06-32', -0.4813,  93.4),
    ('02-14_06-58', -0.9442,  40.2),
    ('02-14_23-25', -0.4222,  86.6),
    ('02-15_00-13', -1.0199,  36.6),
    ('02-15_03-32', -0.0499, 122.7),
    ('02-15_19-03', -0.0944, 116.6),
    ('02-15_22-16', -0.4074,  98.1),
    ('02-16_03-47', -0.8588,  62.2),
    ('02-16_07-20', -0.3044,  92.1),
    ('02-16_11-21', -0.2878,  90.6),
    ('02-16_15-19', -0.1777, 108.2),
    ('02-16_18-12', -0.1398, 108.9),
    ('02-16_23-55', -1.3318,   9.2),
    ('02-17_00-58', -0.6377,  79.3),
    ('02-17_02-11', -0.6817,  59.2),
    ('02-17_02-56', -0.3998,  93.5),
    ('02-17_02-58', -0.2568,  96.5),
    ('02-17_03-39', -0.5039,  74.9),
    ('02-17_23-37',  0.3049, 156.2),
    ('02-18_00-27',  0.2772, 150.1),
    ('02-18_22-13', -0.0871, 118.5),
    ('02-19_22-21',  0.2781, 150.9),
    ('02-19_23-49', -0.0136, 125.0),
]

pmvs_onoff  = [d[1] for d in data_onoff]
costs_onoff = [d[2] for d in data_onoff]

fig, ax = plt.subplots(figsize=(14, 8.5))

ax.axvspan(-0.5, 0.5, color='#4CAF50', alpha=0.08, label='Zona comfort PMV [-0.5, +0.5]')
ax.axvline(-0.5, color='#4CAF50', linestyle='--', alpha=0.5)
ax.axvline(0.5, color='#4CAF50', linestyle='--', alpha=0.5)
ax.axvline(0.0, color='#4CAF50', linestyle=':', alpha=0.3)

ax.plot(pmvs_onoff, costs_onoff, 'o-', color='#333333', linewidth=2.5,
        markersize=11, zorder=4, label='ON/OFF (curva)')

for sp, pmv, cost in data_onoff:
    ax.annotate(f'SP={sp}°C',
                (pmv, cost),
                textcoords='offset points',
                xytext=(0, 14),
                fontsize=8.5, fontweight='bold', ha='center', color='#333333')

ppo_pmvs = [d[1] for d in ppo_all]
ppo_costs = [d[2] for d in ppo_all]
ax.scatter(ppo_pmvs, ppo_costs, marker='s', color='#1565C0', s=50, alpha=0.55,
           edgecolors='white', linewidth=0.5, zorder=5, label=f'PPO ({len(ppo_all)} modelos)')

sac_pmvs = [d[1] for d in sac_all]
sac_costs = [d[2] for d in sac_all]
ax.scatter(sac_pmvs, sac_costs, marker='D', color='#C62828', s=50, alpha=0.55,
           edgecolors='white', linewidth=0.5, zorder=5, label=f'SAC ({len(sac_all)} modelos)')

ppo_real_pmv = -0.2684
ppo_real_cost = 110.3
ax.plot(ppo_real_pmv, ppo_real_cost, marker='*', color='#2E7D32', markersize=22,
        markeredgecolor='white', markeredgewidth=1.2, zorder=6,
        label='PPO 20x (costo real)')
ax.annotate('PPO 20x\n(real)',
            (ppo_real_pmv, ppo_real_cost),
            textcoords='offset points',
            xytext=(-50, 15),
            fontsize=11, fontweight='bold', color='#2E7D32',
            arrowprops=dict(arrowstyle='->', color='#2E7D32', lw=1.5))

ppo_mult_pmv = -0.2684
ppo_mult_cost = 113.7
ax.plot(ppo_mult_pmv, ppo_mult_cost, marker='*', color='#FFD600', markersize=22,
        markeredgecolor='#333333', markeredgewidth=1.2, zorder=6,
        label='PPO 20x (con multiplicador)')
ax.annotate('PPO 20x\n(con mult)',
            (ppo_mult_pmv, ppo_mult_cost),
            textcoords='offset points',
            xytext=(15, 15),
            fontsize=11, fontweight='bold', color='#F57F17',
            arrowprops=dict(arrowstyle='->', color='#F57F17', lw=1.5))

ax.set_xlabel('PMV promedio anual', fontsize=14)
ax.set_ylabel('Costo anual ($k)', fontsize=14)
ax.set_title('PMV promedio anual vs Costo: ON/OFF, todos los PPO y SAC', fontsize=15, fontweight='bold')
ax.legend(fontsize=11, loc='upper left')
ax.grid(alpha=0.3)

plt.tight_layout()
plt.savefig('pmv_promedio_vs_costo.png', dpi=150, bbox_inches='tight')
print('Gráfica guardada: pmv_promedio_vs_costo.png')
